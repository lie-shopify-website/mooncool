
{% schema %}
    {
      "name": "CM Promo Mosaic",
      "settings": [
      ],
      "max_blocks": 3,
      "blocks": [
        {
          "type": "promo_big_image",
          "name": "Promo Big Image",
          "settings": [
            { "type": "header","content":"图片"},
            { "type": "image_picker", "id": "image", "label": "图片" },
            { "type": "image_picker", "id": "image_mb", "label": "图片 (手机端)" },
            { "type": "header","content":"视频"},
            { "type": "video", "id": "slide_video", "label": "视频" },
            { "type": "video", "id": "slide_video_mb", "label": "视频 (手机端)" },
            { "type": "paragraph","content":"当同时存在视频和图片时, 视频优先, 而图片则会当成视频的封面"},
            { "type": "textarea", "id": "title", "default": "Some title", "label": "Title" },
            { "type": "textarea", "id": "desc", "default": "<p>Some description</p>", "label": "Desc" }, 
            { "type": "url", "id": "button_link", "label": "Button Link" }, 
            { "type": "text", "id": "button_label", "label": "Button Label", "default": "Explore More" }
          ]
        },
        {
          "type": "promo_small_image",
          "name": "Promo Small Image",
          "settings": [
            { "type": "header","content":"图片"},
            { "type": "image_picker", "id": "image", "label": "图片" },
            { "type": "image_picker", "id": "image_mb", "label": "图片 (手机端)" },
            { "type": "header","content":"视频"},
            { "type": "video", "id": "slide_video", "label": "视频" },
            { "type": "video", "id": "slide_video_mb", "label": "视频 (手机端)" },
            { "type": "paragraph","content":"当同时存在视频和图片时, 视频优先, 而图片则会当成视频的封面"},
            { "type": "textarea", "id": "title", "default": "Some title", "label": "Title" },
            { "type": "textarea", "id": "desc", "default": "<p>Some description</p>", "label": "Desc" }, 
            { "type": "url", "id": "button_link", "label": "Button Link" }, 
            { "type": "text", "id": "button_label", "label": "Button Label", "default": "Explore More" }
          ]
        }
      ],
      
      "presets": [
        {
          "name": "CM Promo Mosaic",
          "category": "custom",
          "blocks": [
                { "type": "promo_big_image" },
                { "type": "promo_small_image" },
                { "type": "promo_small_image" }
            ]
        }
      ]
    }
  {% endschema %}
  
  
  {{ 'cm-promo-mosaic.css' | asset_url | stylesheet_tag }}
  
  <div class="cm-promo-mosaic section-space" data-section-id="{{ section.id }}">
    <div class="safe-container">
        <div class="promo-layout">
            <div class="promo-grid">
                {% for block in section.blocks %}
                    <div class="grid-item" data-block-type="{{ block.type }}">
                        <div class="image-box">
                            {% if block.settings.button_link != blank %}<a href="{{ block.settings.button_link }}"></a>{% endif %}

                            {% if block.settings.slide_video != blank and block.settings.slide_video_mb != blank  %}
                                {% comment %} 视频 {% endcomment %}
                                {% liquid
                                  assign video_url = block.settings.slide_video.sources[0].url
                                  assign video_mb_url = block.settings.slide_video_mb.sources[0].url

                                  if block.settings.slide_video.sources[1].url != blank
                                    assign video_url = block.settings.slide_video.sources[1].url
                                  endif
                                  if block.settings.slide_video_mb.sources[1].url != blank
                                  assign video_mb_url = block.settings.slide_video_mb.sources[1].url
                                  endif
                                %}
                                <video 
                                    class="cm-promo-mosaic-video"
                                    autoplay 
                                    muted 
                                    playsinline
                                    webkit-playsinline
                                    loop
                                    preload="metadata"
                                >
                                    <source src="{{ video_url }}" type="video/mp4" media="(min-width: 1280px)">
                                    <source src="{{ video_url }}" type="video/mp4" media="(min-width: 768px)">
                                    <source src="{{ video_mb_url }}" type="video/mp4">
                                </video>
                            {% else %}
                                {% comment %} 图片 {% endcomment %}
                                {% if forloop.first %}  {% comment %} LCP需要, 首屏第一个图片不做懒加载 {% endcomment %}
                                    <picture>
                                        <source srcset="{{ block.settings.image_mb | image_url: width: 767 }}"  media="(max-width: 767px)" />
                                        <source srcset="{{ block.settings.image | image_url: width: block.settings.bg.width }}" media="(min-width: 768px)" />
                                        <img src="{{ block.settings.image_mb | image_url: width: 767 }}" width="auto" height="auto" />
                                    </picture>
                                {% else %}
                                    <picture>
                                        <source data-srcset="{{ block.settings.image_mb | image_url: width: 767 }}"  media="(max-width: 767px)" />
                                        <source data-srcset="{{ block.settings.image | image_url: width: block.settings.bg.width }}" media="(min-width: 768px)" />
                                        <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-lzsrc="{{ block.settings.image_mb | image_url: width: 767 }}" class="js-lazy" width="auto" height="auto" />
                                    </picture>
                                {% endif %}
                            {% endif %}

                        </div>
                        <div class="content-box">
                            <div class="content-inner">
                                {% if block.settings.desc != blank %}
                                    <div class="promo-desc">{{ block.settings.desc }}</div>
                                {% endif %}
                                {% if block.settings.title != blank %}
                                    <div class="promo-title"><h2>{{ block.settings.title }}</h2></div>
                                {% endif %}

                                {% if block.settings.button_link != blank and block.settings.button_label != blank %}
                                    <a href="{{ block.settings.button_link }}" class="promo-btn">
                                        <span>{{ block.settings.button_label }}</span>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>  
  </div>